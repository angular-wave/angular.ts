<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>AngularTS</title>
    <link rel="shortcut icon" type="image/png" href="images/favicon.ico" />
    <script type="module" src="/src/index.js"></script>
    <script>
      const cookieStorage = {
        getItem(key) {
          const cookies = document.cookie.split(";").map((c) => c.trim());
          for (const c of cookies) {
            const [k, ...rest] = c.split("=");
            if (k === decodeURIComponent(key)) {
              return decodeURIComponent(rest.join("="));
            }
          }
          return null;
        },

        setItem(key, value, options = {}) {
          const cookie = [
            `${encodeURIComponent(key)}=${encodeURIComponent(value)}`,
            options.expires ? `Expires=${options.expires.toUTCString()}` : "",
            options.path ? `Path=${options.path}` : "Path=/",
            options.domain ? `Domain=${options.domain}` : "",
            options.secure ? "Secure" : "",
            options.sameSite ? `SameSite=${options.sameSite}` : "",
          ]
            .filter(Boolean)
            .join("; ");

          document.cookie = cookie;
        },

        removeItem(key, options = {}) {
          this.setItem(key, "", {
            ...options,
            expires: new Date(0),
          });
        },

        getAll() {
          const out = {};
          const cookies = document.cookie.split(";").map((c) => c.trim());
          for (const c of cookies) {
            const [k, ...rest] = c.split("=");
            out[decodeURIComponent(k)] = decodeURIComponent(rest.join("="));
          }
          return out;
        },
      };

      document.addEventListener("DOMContentLoaded", () => {
        angular
          .module("app", [])
          .store(
            "sessionStore",
            class {
              counter = 0;
            },
            "session",
          )
          .store("localStore", () => ({ counter: 0 }), "local")
          .store("cookieStore", { counter: 0 }, "cookie");
      });
    </script>
  </head>
  <body ng-app="app">
    <div ng-inject="sessionStore">
      {{ sessionStore.counter }}
      <button ng-click="sessionStore.counter = sessionStore.counter + 1">
        +
      </button>
    </div>

    <div ng-inject="localStore">
      {{ localStore.counter }}
      <button ng-click="localStore.counter = localStore.counter + 1">+</button>
    </div>

    <div ng-inject="cookieStore">
      {{ cookieStore.counter }}
      <button ng-click="cookieStore.counter = cookieStore.counter + 1">
        +
      </button>
    </div>

    <div ng-inject="sessionStore, cookieStore, localStore">
      Total: {{ sessionStore.counter + cookieStore.counter + localStore.counter
      }}
    </div>
  </body>
</html>
